apiVersion: score.dev/v1b1

metadata:
  name: order-service

containers:
  main:
    image: myorg/order-service:v1.1.0  # Updated version with S3 support
    env:
      # Existing database credentials
      DATABASE_URL: ${resources.db.connection_string}
      DATABASE_HOST: ${resources.db.host}
      DATABASE_PORT: ${resources.db.port}
      DATABASE_NAME: ${resources.db.database_name}
      DATABASE_USER: ${resources.db.username}
      DATABASE_PASSWORD: ${resources.db.password}

      # NEW: S3 storage credentials (added in v2)
      S3_ENDPOINT: ${resources.receipts.endpoint}
      S3_BUCKET: ${resources.receipts.bucket}
      S3_ACCESS_KEY: ${resources.receipts.access_key}
      S3_SECRET_KEY: ${resources.receipts.secret_key}

resources:
  # PostgreSQL database - existing resource, not reprovisioned
  db:
    type: postgres
    properties:
      version: "15"
      size: "medium"
      replicas: 2

  # S3 storage - NEW resource for order receipt PDFs
  receipts:
    type: s3
    properties:
      size: "standard"
      versioning: true
      public_read: false
